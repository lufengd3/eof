<script>
    (function() {
         window.EOF = {
            version: '0.0.1',

            register: function(conf) {
                let self = this;
                let thisDoc = document.currentScript.ownerDocument;
                let tpl = thisDoc.querySelector(`#${conf.is}`);
                
                if (!tpl) {
                    throw new Error(`Can't find template Node: ${conf.is}`);
                    return;
                }
                
                let proto = Object.create(HTMLElement.prototype, {
                    createdCallback: {
                        value: function() {
                            let tplContent = self._parseTpl(tpl, conf.data);
                            let clone = document.importNode(tplContent, true);
                            
                            this.createShadowRoot().appendChild(clone);
                        }
                    }        
                });

                document.registerElement(conf.is, {prototype: proto});
                self.telemetry._registrate(conf.is);
            },

            telemetry: {
                registions: [],
                _registrate: function(elm) {
                    this.registions.push(elm);
                },
                _regLog: function(elm) {
                     console.log(`<${elm}> registered`);        
                },
                dumpRegistrations: function() {
                    this.registions.forEach(this._regLog);        
                }
            },
            
            _parseTpl: function(tpl, data) {
                return tpl.content;
            }
        }
    })();
</script>
